
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Seven Story Rabbit Hole</title>
  <meta name="author" content="Traun Leyden">

  
  <meta name="description" content="Get this spinning gopher working with Go and OpenGL on OSX Mavericks via gogl Steps 1
2
3
4
5
6
7
8
$ brew install glfw2
$ go get -u -v github.com/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tleyden.github.io/blog/page/4">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Seven Story Rabbit Hole" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>

  <table><tr><td>
  <h1><a href="/">Seven Story Rabbit Hole</a></h1>
  
    <h2>Sometimes awesome things happen in deep rabbit holes.  Or not.</h2>
  
  </td><td>&nbsp;&nbsp;
  <img class="left" src="/images/rabbit_hole_graphic.png" width="132" height="105" title="image" alt="images">
  </td></tr>
  </table>

</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tleyden.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/08/playing-with-go-and-opengl/">Playing With Go and OpenGL</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-08T16:01:00+00:00" pubdate data-updated="true">Feb 8<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Get this spinning gopher working with Go and OpenGL on OSX Mavericks via <a href="https://github.com/chsc/gogl/">gogl</a></p>

<iframe width="420" height="315" src="//www.youtube.com/embed/yae-bRLdfaU" frameborder="0" allowfullscreen></iframe>


<h1>Steps</h1>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew install glfw2
</span><span class='line'>$ go get -u -v github.com/tleyden/gogl
</span><span class='line'>$ go get -u -v github.com/go-gl/glfw  
</span><span class='line'>$ cd $GOPATH/src/github.com/tleyden/gogl
</span><span class='line'>$ make bindings
</span><span class='line'>$ go get -u -v github.com/chsc/gogl
</span><span class='line'>$ cd $GOPATH/src/github.com/tleyden/gogl/examples/gopher
</span><span class='line'>$ go run gopher.go</span></code></pre></td></tr></table></div></figure>


<p>NOTE: if <a href="https://github.com/chsc/gogl/pull/37">pull request #37</a> has already been merged into <a href="https://github.com/chsc/gogl/">gogl</a>, then replace <code>github.com/tleyden/gogl</code> with <code>https://github.com/chsc/gogl</code> in steps above.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/02/06/why-use-go-when-you-can-just-use-c-plus-plus/">Why Use Go When You Can Just Use C++?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-02-06T08:25:00+00:00" pubdate data-updated="true">Feb 6<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I recently saw this on a mailing list:</p>

<blockquote><p>What are the advantages of Go against C++ or other languages?</p></blockquote>

<h1>Go has sane concurrency.</h1>

<p>In C++ the main tool to deal with concurrency is pthreads, but making threaded programming correct is extremely difficult and error prone.  Trying to make it performant by minimizing locking makes it even more challenging.</p>

<p>Go, OTOH, has a concept of goroutines and channels for concurrency.  The idea has its roots in CSP (communicating sequential processing), and is not unlike Erlang&rsquo;s style of having processes that communicating by message passing.</p>

<p>In Go, instead of having threads communicating by sharing memory (and locking), goroutines share memory by communicating over channels.  Eg, concurrent goroutines communicate over channels, and each goroutine&rsquo;s internal state is private to that goroutine.  Also, concurrency and their constructs like channels are built right into the Go language, which affords many advantages over languages that have had concurrency slapped on as an afterthought.</p>

<h1>Other Strengths</h1>

<ul>
<li>No unsafe pointer arithmetic.</li>
<li>Array bound checking</li>
<li>Write once run anywhere</li>
<li>Closures (eg, lambdas)</li>
<li>Functions are first class objects</li>
<li>Multiple return values</li>
<li>Does not have IFDEF&rsquo;s, so no IFDEF hell and unmaintainable code.</li>
<li>Compiles blazingly fast</li>
<li>Gofmt &ndash; All code is uniformly formatted, making codebases much easier to read.  (a la Python)</li>
<li>Garbage collection</li>
</ul>


<h1>Weaknesses</h1>

<ul>
<li>Lack of generics</li>
<li>Not quite as fast as C/C++ (partly due to GC overhead)</li>
<li>Integration with existing native code is a bit limited (you can&rsquo;t build libraries in Go or link Go code into a C/C++ executable)</li>
<li>IDE support is limited compared to C/C++/Obj-C/Java</li>
<li>Doesn&rsquo;t work with regular debugging tools because it doesn&rsquo;t use normal calling conventions.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/31/a-stubbed-out-gradle-multi-project-hierarchy-using-git-submodules/">A Stubbed Out Gradle Multi-project Hierarchy Using Git Submodules</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-31T10:50:00+00:00" pubdate data-updated="true">Jan 31<span>st</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&rsquo;m about to split up the <a href="https://github.com/couchbase/couchbase-lite-android">couchbase-lite</a> android library into two parts: a pure-java and an android specific library.  The android library will depend on the pure-java library.</p>

<p>Before going down this project refactoring rabbit hole for the real project, I decided to stub out a complete project hierarchy to validate that it was going to actually work.  (I&rsquo;m calling this project hierarchy &ldquo;stubworld&rdquo; for lack of a sillier name)</p>

<p>There are five projects in total, here are the two top-level projects</p>

<p><a href="https://github.com/tleyden/stubworld-app-android">https://github.com/tleyden/stubworld-app-android</a>  (an Android app)</p>

<p><img src="http://cl.ly/image/3O31321l0b0n/stubworld_architecture_android.png" alt="" /></p>

<p><a href="https://github.com/tleyden/stubworld-app-cmdline">https://github.com/tleyden/stubworld-app-cmdline</a>  (a pure java Command Line application)</p>

<p><img src="http://cl.ly/image/1M2C333S2s0u/stubworld_architecture_desktop.png" alt="" /></p>

<p>The projects are all self contained gradle projects and can be imported in either Android Studio or IntelliJ CE 13, and the dependencies on lower level projects are done via git submodules (and even git sub-submodules, <em>gulp</em>).   In either top level project you can easily debug and edit the code in the lower level projects, since they use source level dependencies.</p>

<p>The biggest sticking point I ran into was that initially I tried to include a dependency via:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>compile project(':libraries:stubworld-corelib-java')</span></code></pre></td></tr></table></div></figure>


<p>which totally broke when trying to embed this project into another parent project. The fix was to change it to use a relative path by removing the leading colon:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>compile project('libraries:stubworld-corelib-java')</span></code></pre></td></tr></table></div></figure>


<p>I&rsquo;m posting this in case it&rsquo;s useful to anyone who needs to do something similar, or if any Gradle / Android Studio Jedi masters have any feedback like &ldquo;why did you do X, when you just could have done Y?&rdquo;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/01/13/objective-c-coding-interview-challenge-urlpuller/">Objective C Coding Interview Challenge: URLPuller</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-13T11:45:00+00:00" pubdate data-updated="true">Jan 13<span>th</span>, 2014</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Programming Challenge</h1>

<p>The goal is to create an Objective-C class which takes an array of NSURL&rsquo;s, downloads their contents asynchronously, and writes the contents of each URL to a unique file.</p>

<p>The class should be named URLPuller and should have the following instance methods:</p>

<ul>
<li><code>- (void) downloadUrlsAsync: (NSArray*)urls</code></li>
<li><code>- (void) waitUntilAllDownloadsFinish</code></li>
<li><code>- (NSString*) downloadedPathForURL: (NSURL*)url</code></li>
</ul>


<p>Here are the detailed descriptions of each method:</p>

<h2>downloadUrlsAsync</h2>

<p><code>- (void) downloadUrlsAsync: (NSArray*)urls</code></p>

<p>The urls array will contain an array of NSURL&rsquo;s.  The method should return immediately, eg, it&rsquo;s an asynchronous API call that will run in the background.</p>

<p>The downloaded files can be stored in any directory, where the filename is {sha1 hash of url}.downloaded</p>

<h2>waitUntilAllDownloadsFinish</h2>

<p><code>- (void) waitUntilAllDownloadsFinish</code></p>

<p>Block until all of the URLs have been downloaded.</p>

<p>If this is called while there is no download in progress, it should return immediately.  Otherwise, it should block until all the downloads have finished.</p>

<h2>downloadedPathForURL</h2>

<p><code>- (NSString*) downloadedPathForURL: (NSURL*)url</code></p>

<p>Return the path where the given url was downloaded to.</p>

<p>If the given url has not been downloaded yet, or was never requested to be downloaded, then it should return nil.</p>

<h1>Objectives</h1>

<p>Demonstrate that:</p>

<ul>
<li>You can write a program that satisfies the API methods and described behavior.</li>
<li>You can write code that is well factored, and easy to understand.</li>
<li>You can clearly communicate questions (if any arise) regarding this specification.</li>
</ul>


<h1>Deliverable</h1>

<ul>
<li>Zipped Xcode project directory or a link to github repo that contains the Xcode project.  It can be either an iOS or MacOS project.</li>
</ul>


<h1>Rules</h1>

<ul>
<li>You can use any available resource you can find on the Internet &mdash; eg, Stack Overflow, API docs, etc.</li>
<li>You may not ask questions related to the problem on Stack Overflow, IRC, etc.  (eg, the Internet is &ldquo;read-only&rdquo;)</li>
<li>You cannot use any 3rd party libraries or products, you can only use classes and API&rsquo;s in the standard iOS/Cocoa Objective-C runtime.  If in doubt, just ask.</li>
<li>You are welcome to go above and beyond the call of duty in any way that you see fit, however with the constraint that you must provide the above methods with signatures exactly matching with the specification.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/12/19/how-to-downgrade-android-studio/">How to Downgrade Android Studio</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-19T17:01:00+00:00" pubdate data-updated="true">Dec 19<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I just tried to update to Android Studio 0.4, however was stung by <a href="https://code.google.com/p/android/issues/detail?id=61573#c14">Issue 61573: Gradle duplicate file exception when package apk file with jar dependencies that contains resources.</a></p>

<p>The good news is that it&rsquo;s very easy to downgrade!  Thank Google, because there is nothing more annoying than not being able to back out of an upgrade gone bad.</p>

<p>Here&rsquo;s how I did it on OSX Mavericks:</p>

<ul>
<li><p>Download 0.3.7 from <a href="http://tools.android.com/download/studio/canary/0-3-7">http://tools.android.com/download/studio/canary/0-3-7</a></p></li>
<li><p>Unzip it by double clicking it.</p></li>
<li><p>In a command line, run the following:</p></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ mv /Applications/Android\ Studio.app /tmp/
</span><span class='line'>$ mv ~/Downloads/Android\ Studio.app /Applications/
</span><span class='line'>$ cp -R /tmp/Android\ Studio.app/sdk /Applications/Android\ Studio.app/</span></code></pre></td></tr></table></div></figure>


<p>The last step is necessary because the dowloaded 0.3.7 Android Studio will not have an SDK directory.  (Note: at this point you can also use <code>mv</code> instead of <code>cp</code> if you don&rsquo;t want to use the extra disk space)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/23/understanding-chan-chans-in-go/">Understanding Chan Chan&#8217;s in Go</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-23T07:58:00+00:00" pubdate data-updated="true">Nov 23<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A channel describes a transport of sorts.  You can send a thing down that transport.  When using a chan chan, the thing you want to send down the transport is another transport to send things back.</p>

<p>They are useful when you want to get a response to something, and you don&rsquo;t want to setup two channels (it&rsquo;s generally considered bad practice to have data moving bidirectionally on a single channel)</p>

<h2>Visual time lapse walkthrough</h2>

<p>Keep in mind that Goroutine C is the &ldquo;real consumer&rdquo; even though it will be the one which writes to the request channel.</p>

<p>The request channel starts out empty.</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/go_chan_chan_1.png" alt="Screenshot" /></p>

<p>Goroutine C passes a &ldquo;response channel&rdquo; to go routine D via the request channel</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/go_chan_chan_2.png" alt="Screenshot" /></p>

<p>Goroutine C starts reading from the (still empty) response channel.</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/go_chan_chan_3.png" alt="Screenshot" /></p>

<p>Goroutine D writes a string to the response channel</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/go_chan_chan_4.png" alt="Screenshot" /></p>

<p>Goroutine C now is able to read a value from response channel, and get&rsquo;s the &ldquo;wassup!&rdquo; message</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/go_chan_chan_5.png" alt="Screenshot" /></p>

<p>And now we are back to where we started</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/go_chan_chan_1.png" alt="Screenshot" /></p>

<h2>Here is some code that uses chan chan&rsquo;s</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>package main
</span><span class='line'>
</span><span class='line'>import "fmt"
</span><span class='line'>import "time"
</span><span class='line'>
</span><span class='line'>func main() {
</span><span class='line'>
</span><span class='line'>     // make the request chan chan that both go-routines will be given
</span><span class='line'>     requestChan := make(chan chan string)
</span><span class='line'>
</span><span class='line'>     // start the goroutines
</span><span class='line'>     go goroutineC(requestChan)
</span><span class='line'>     go goroutineD(requestChan)
</span><span class='line'>
</span><span class='line'>     // sleep for a second to let the goroutines complete
</span><span class='line'>     time.Sleep(time.Second)
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>func goroutineC(requestChan chan chan string) {
</span><span class='line'>
</span><span class='line'>     // make a new response chan
</span><span class='line'>     responseChan := make(chan string)
</span><span class='line'>
</span><span class='line'>     // send the responseChan to goRoutineD
</span><span class='line'>     requestChan &lt;- responseChan
</span><span class='line'>
</span><span class='line'>     // read the response
</span><span class='line'>     response := &lt;-responseChan
</span><span class='line'>
</span><span class='line'>     fmt.Printf("Response: %v\n", response)
</span><span class='line'>
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>func goroutineD(requestChan chan chan string) {
</span><span class='line'>
</span><span class='line'>     // read the responseChan from the requestChan
</span><span class='line'>     responseChan := &lt;-requestChan
</span><span class='line'>
</span><span class='line'>     // send a value down the responseChan
</span><span class='line'>     responseChan &lt;- "wassup!"
</span><span class='line'>
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>This code can be run on <a href="http://play.golang.org/p/chi6P2XGTO">Go playground</a></p>

<h2>For more information</h2>

<p>See <a href="https://www.youtube.com/watch?v=QDDwwePbDtw">Google I/O 2013 &ndash; Advanced Go Concurrency Patterns</a> around 17:00.  This contains another explanation of chan chan&rsquo;s.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/22/android-studio-plus-genymotion-emulator/">Android Studio + Genymotion Emulator</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-22T15:51:00+00:00" pubdate data-updated="true">Nov 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The Android emulator is dog slow.  The x86 intel emulators only work with certain versions of OSX, otherwise they crash miserably.</p>

<p>Genymotion is apparently pretty good, so I&rsquo;m giving that a shot.</p>

<p>Here&rsquo;s how to do it.</p>

<h2>Download and Install VirtualBox</h2>

<p><a href="https://www.virtualbox.org/wiki/Downloads">Download VirtualBox</a> + follow instructions to install.</p>

<h2>Signup with Genymotion + Download installer</h2>

<ul>
<li><p>Go to <a href="http://www.genymotion.com">genymotion.com</a> and signup</p></li>
<li><p>Click the &ldquo;Get Genymotion&rdquo; button and <a href="https://cloud.genymotion.com/page/launchpad/download/">download</a> the appropriate version for your OS.</p></li>
</ul>


<h2>Run the Genymotion application</h2>

<p>It will install Genymotion and Genmotion shell &mdash; run the Genymotion application (not the shell).</p>

<p>When you run it, you will see:</p>

<p><img src="http://cl.ly/image/0e1j3t1j1V3F/Screen%20Shot%202013-11-22%20at%203.57.11%20PM.png" alt="Screenshot" /></p>

<p>Click add new virtual device.  It will ask you to login, then show you a list:</p>

<p><img src="http://cl.ly/image/2i3M2D0p2M2J/Screen%20Shot%202013-11-22%20at%203.59.41%20PM.png" alt="Screenshot" /></p>

<p>Pick the virtual device you want and it will download it.</p>

<h2>Try starting a virtual device</h2>

<p>Here&rsquo;s what happened on my system:</p>

<ul>
<li>Hit Play to run virtual device</li>
<li>It asked me to configure the Android SDK location, I said &ldquo;No&rdquo;</li>
<li>Then it gave me an error that VirtualBox was not installed</li>
<li>I started VirtualBox manually</li>
<li>I retried running the virtual device, this time it worked and I saw</li>
</ul>


<p><img src="http://cl.ly/image/252a1T3d2U1x/Screen%20Shot%202013-11-22%20at%204.06.46%20PM.png" alt="Screenshot" /></p>

<h2>Configure Android Studio plugin</h2>

<p>Go to Preferences / Plugins and click &ldquo;Browse Repositories&rdquo;, then search for Genymotion.  Right click and choose &ldquo;Download and Install&rdquo;.</p>

<p><img src="http://cl.ly/image/110z2N2i1S3N/Screen%20Shot%202013-11-22%20at%204.08.42%20PM.png" alt="Screenshot" /></p>

<p>Restart Android Studio and you should see a new icon in your IDE.</p>

<p><img src="http://cl.ly/image/0F0N330u0C32/Screen%20Shot%202013-11-22%20at%204.11.00%20PM.png" alt="Screenshot" /></p>

<p>Click the icon and it will bring up Preferences, and choose the path to the Genymotion application.</p>

<p><img src="http://cl.ly/image/3G3K1s0p2h3x/Screen%20Shot%202013-11-22%20at%204.14.05%20PM.png" alt="Screenshot" /></p>

<p>Now if you click the Genymotion icon again, you will see the list of devices available:</p>

<p><img src="http://cl.ly/image/1Y120s1n1d2l/Screen%20Shot%202013-11-22%20at%204.15.20%20PM.png" alt="Screenshot" /></p>

<h2>Start an emulator</h2>

<p>Click the Genymotion icon within Android studio, select a virtual device, and hit start.</p>

<p>It will ask you to choose the location of the SDK:</p>

<p><img src="http://cl.ly/image/2N0W1h0O3Q2H/Screen%20Shot%202013-11-22%20at%204.18.02%20PM.png" alt="Screenshot" /></p>

<p>On Mac OSX, I was not able to brows to the path since the application was greyed out in the chooser dialog, so I went onto the shell and found it (/Applications/Android Studio.app/sdk) and just copied and pasted it:</p>

<p><img src="http://cl.ly/image/2V2H0d0M1z0f/Screen%20Shot%202013-11-22%20at%204.21.12%20PM.png" alt="Screenshot" /></p>

<p>Select a virtual device, and hit start (again).  It should come up now.</p>

<h2>Deploy an application/test to that emulator</h2>

<p>In Android Studio, hit the &ldquo;Play&rdquo; or &ldquo;Debug&rdquo; button, and you should see the dialog that asks you to choose an emulator:</p>

<p><img src="http://cl.ly/image/1I43000V3h12/Screen%20Shot%202013-11-22%20at%204.25.21%20PM.png" alt="Screenshot" /></p>

<p>and one of the emulators will be the Genymotion emulator.  After you choose that emulator and hit &ldquo;OK&rdquo;, it will run your application in the Genymotion emulator (this is showing the <a href="https://github.com/couchbaselabs/GrocerySync-Android">Grocery Sync</a> demo app for <a href="https://github.com/couchbase/couchbase-lite-android">Couchbase Lite</a>):</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/Genymotion_Grocery_sync.png" alt="Screenshot" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/21/a-simple-data-race-in-go-and-how-to-fix-it/">A Simple Data Race in Go and How to Fix It</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-21T08:16:00+00:00" pubdate data-updated="true">Nov 21<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Suppose you want to add an http handler which can show some things that in memory.</p>

<p>Simple, right?  Actually, if you aren&rsquo;t careful, doing this can lead to data races, even though only one goroutine is writing the data at any given time.</p>

<p>Here&rsquo;s the golang code (also on <a href="https://github.com/tleyden/go-scratchpad/blob/1521d96e8f093b06ed57cd32e702b8ccb458e270/concurrentaccess/main.go">github</a>) that reproduces the issue:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type Foo struct {
</span><span class='line'>  content string
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>type FooSlice []*Foo
</span><span class='line'>
</span><span class='line'>func updateFooSlice(fooSlice FooSlice) {
</span><span class='line'>  for {
</span><span class='line'>      foo := &Foo{content: "new"}
</span><span class='line'>      (*fooSlice)[0] = foo
</span><span class='line'>      time.Sleep(time.Second)
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>func installHttpHandler(fooSlice FooSlice) {
</span><span class='line'>  handler := func(w http.ResponseWriter, r *http.Request) {
</span><span class='line'>      for _, foo := range fooSlice {
</span><span class='line'>          if foo != nil {
</span><span class='line'>              fmt.Fprintf(w, "foo: %v ", (*foo).content)
</span><span class='line'>          }
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>  }
</span><span class='line'>  http.HandleFunc("/", handler)
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>func main() {
</span><span class='line'>  foo1 := &Foo{content: "hey"}
</span><span class='line'>  foo2 := &Foo{content: "yo"}
</span><span class='line'>  fooSlice := FooSlice{foo1, foo2}
</span><span class='line'>
</span><span class='line'>  installHttpHandler(fooSlice)
</span><span class='line'>
</span><span class='line'>  go updateFooSlice(fooSlice)
</span><span class='line'>
</span><span class='line'>  http.ListenAndServe(":8080", nil)
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>if you run this code with <code>go run main.go</code> and then open <code>http://localhost:8080</code> in your browser, it will work as expected.</p>

<p>But not so fast!  Lurking in this code are data races, and if you run this with race detection enabled using <code>go run -race main.go</code> and then access it with the browser, it will panic with:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>==================
</span><span class='line'>WARNING: DATA RACE
</span><span class='line'>Read by goroutine 6:
</span><span class='line'>  main.funcÂ·001()
</span><span class='line'>      /../concurrentaccess/main.go:45 +0x9e
</span><span class='line'>      ...
</span><span class='line'>Previous write by goroutine 4:
</span><span class='line'>  main.updateFooSlice()
</span><span class='line'>      /../concurrentaccess/main.go:35 +0x98
</span><span class='line'>      ...</span></code></pre></td></tr></table></div></figure>


<p>because there are two goroutines accessing the same slice without any protection &mdash; the main goroutine running the http server, and the goroutine running <code>updateFooSlice</code>.</p>

<h2>Fix #1 &ndash; use sync.mutex to lock the slice</h2>

<p>This isn&rsquo;t necessarily the <em>best</em> way to fix this, but it&rsquo;s the simplest to understand and explain.</p>

<p>Here are the changes to the code (also on <a href="https://github.com/tleyden/go-scratchpad/blob/8f031806d5f0d7becef844f5400f2cc663ff4bf7/concurrentaccess/main.go">github</a>):</p>

<ul>
<li>Import the <code>sync</code> package</li>
<li>Create a sync.Mutex object in the package-global namespace</li>
<li>Before updating the slice, lock the mutex, and after updating it, unlock it.</li>
<li>Before the http handler access the slice, it locks the mutex, and after it&rsquo;s done, it unlocks it.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>type Foo struct {
</span><span class='line'>  content string
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>type FooSlice []*Foo
</span><span class='line'>
</span><span class='line'>var mutex sync.Mutex
</span><span class='line'>
</span><span class='line'>func updateFooSlice(fooSlice FooSlice) {
</span><span class='line'>  for {
</span><span class='line'>      mutex.Lock()
</span><span class='line'>      foo := &Foo{content: "new"}
</span><span class='line'>      fooSlice[0] = foo
</span><span class='line'>      fooSlice[1] = nil
</span><span class='line'>      mutex.Unlock()
</span><span class='line'>      time.Sleep(time.Second)
</span><span class='line'>  }
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>func installHttpHandler(fooSlice FooSlice) {
</span><span class='line'>  handler := func(w http.ResponseWriter, r *http.Request) {
</span><span class='line'>      mutex.Lock()
</span><span class='line'>      defer mutex.Unlock()
</span><span class='line'>      for _, foo := range fooSlice {
</span><span class='line'>          if foo != nil {
</span><span class='line'>              fmt.Fprintf(w, "foo: %v ", (*foo).content)
</span><span class='line'>          }
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>  http.HandleFunc("/", handler)
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>func main() {
</span><span class='line'>
</span><span class='line'>  foo1 := &Foo{content: "hey"}
</span><span class='line'>  foo2 := &Foo{content: "yo"}
</span><span class='line'>
</span><span class='line'>  fooSlice := FooSlice{foo1, foo2}
</span><span class='line'>
</span><span class='line'>  installHttpHandler(fooSlice)
</span><span class='line'>
</span><span class='line'>  go updateFooSlice(fooSlice)
</span><span class='line'>
</span><span class='line'>  http.ListenAndServe(":8080", nil)
</span><span class='line'>
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>If you now re-run the code with the <code>-race</code> flag and access <code>http://localhost:8080</code>, it won&rsquo;t panic.</p>

<h2>Digression &ndash; chan chan</h2>

<p>Before we can talk about Fix #2, we need to take a digression to talk about chan chan&rsquo;s &mdash; channels which contain other channels as the morsels of data that pass through the channel tubes (metachannels, if you will).</p>

<p><strong>tl;dr</strong> A channel describes a transport of sorts.  You can send a thing down that transport.  When using a chan chan, the thing you want to send down the transport is another transport to send things back.</p>

<p>If it&rsquo;s still a little fuzzy for you, here&rsquo;s the <a href="http://tleyden.github.io/blog/2013/11/23/understanding-chan-chans-in-go/">long description of chan chan&rsquo;s with diagrams</a></p>

<h2>Fix #2 &ndash; Use channels instead of <code>sync.Mutex</code></h2>

<p>In this version of the fix, the goroutine running the http handler (the main goroutine in this case), makes a response chan and passes it into a request chan chan that both goroutines can access.  It then reads the response from the response chan, which will contain a copy of the FooSlice.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>func installHttpHandler(fooSlice FooSlice) {
</span><span class='line'>        handler := func(w http.ResponseWriter, r *http.Request) {
</span><span class='line'>                response := make(chan FooSlice)
</span><span class='line'>                request &lt;- response
</span><span class='line'>                fooSliceCopy := &lt;-response
</span><span class='line'>                for _, foo := range fooSliceCopy {
</span><span class='line'>                        if foo != nil {
</span><span class='line'>                                fmt.Fprintf(w, "foo: %v ", (*foo).content)
</span><span class='line'>                        }
</span><span class='line'>                }
</span><span class='line'>        }
</span><span class='line'>        http.HandleFunc("/", handler)
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>The other goroutine updates the FooSlice and is also checking the request chan chan for new messages.  If it gets a new request message, it makes a copy of the FooSlice and sends it to the response chan.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>func updateFooSlice(fooSlice FooSlice) {
</span><span class='line'>        t := time.Tick(time.Second)
</span><span class='line'>        for {
</span><span class='line'>                select {
</span><span class='line'>                case &lt;-t:
</span><span class='line'>                        foo := &Foo{content: "new"}
</span><span class='line'>                        fooSlice[0] = foo
</span><span class='line'>                        fooSlice[1] = nil
</span><span class='line'>                case ch := &lt;-request:
</span><span class='line'>                        fooSliceCopy := make(FooSlice, len(fooSlice))
</span><span class='line'>                        copy(fooSliceCopy, fooSlice)
</span><span class='line'>                        ch &lt;- fooSliceCopy
</span><span class='line'>                }
</span><span class='line'>        }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>Again, if you now re-run this code with the <code>-race</code> flag and access <code>http://localhost:8080</code>, it won&rsquo;t panic.</p>

<p>The full code sample is <a href="https://github.com/tleyden/go-scratchpad/blob/e92685b35c2d6f61274c7e72a3cdebf85817878a/concurrentaccess/main.go">available on gihub</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/20/debugging-http-traffic-in-android-apps-with-a-proxy/">Debugging HTTP Traffic in Android Apps With a Proxy</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-20T14:35:00+00:00" pubdate data-updated="true">Nov 20<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>If you need to debug the HTTP communication between a server and an Android app running in an emulator or device, here&rsquo;s some instructions on how I went about doing it.</p>

<p>Here&rsquo;s the overall diagram of what&rsquo;s happening:</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/android_proxy.png" alt="Diagram" /></p>

<h2>Install a Proxy</h2>

<p>I&rsquo;m using <a href="http://www.charlesproxy.com/">Charles Proxy</a> and highly recommend it.</p>

<p>As far as proxy configuration, the defaults should be fine.  It should be listening on port 8888 and proxying everything.  If you need HTTPS, you might have to configure that, I don&rsquo;t remember if it&rsquo;s enabled by default.</p>

<h2>Configure the Android Emulator to use that proxy</h2>

<p>There is a blog that describes how to get to this screen, I don&rsquo;t have the link handy.  Essentially once you get to this screen, just update the ip to have the special 10.0.2.2 ip address which represents your workstation, and the port the proxy is listening on (port 8888).</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/android_emu_proxy_config.png" alt="Screenshot" /></p>

<h2>Run an HTTP server on your workstation, on port 4984</h2>

<p>Actually use any port you want, but in my case I&rsquo;m connecting to a server that runs on port 4984.</p>

<h2>Configure your app to connect to 127.0.0.1:4984</h2>

<p>This is actually a bit counterintuitive, but the idea is that the address must be reachable from the workstation&rsquo;s network, not from the emulator&rsquo;s network.</p>

<p>So for that reason, if the server is running on the workstation, you would want to use 127.0.0.1 as the IP.</p>

<p>As long as the server is reachable from your workstation, you can use that IP and it will go through the proxy.</p>

<h2>View HTTP traffic in proxy</h2>

<p>Here&rsquo;s what the HTTP JSON response looks like in the proxy:</p>

<p><img src="http://tleyden-misc.s3.amazonaws.com/blog_images/charles_proxy_screenshot.png" alt="Screenshot" /></p>

<h2>If you are using the Genymotion emulator</h2>

<p>The Genymotion emulator has a different method of modifying the proxy setting:</p>

<p>In your virtual device:</p>

<ul>
<li>Go to Android settings menu</li>
<li>In Wireless &amp; Networks section, select Wi-Fi</li>
<li>Press and hold for 2 seconds WiredSSID network in the list</li>
<li>Choose Modify Network</li>
<li>Check Show advanced options</li>
<li>Select Manual for Proxy settings menu entry</li>
<li>Now enter the proxy settings provided by your network administrator

<ul>
<li>Ip: 10.0.3.2 (this is a special ip that Genymotion uses to connect back to the host)</li>
<li>Port: 8888</li>
</ul>
</li>
<li>Finally press the Save button</li>
</ul>


<p>If you don&rsquo;t have Genymotion running, you should check it out, it runs <em>much</em> faster than the default emulator.  <a href="http://tleyden.github.io/blog/2013/11/22/android-studio-plus-genymotion-emulator/">How to get Android Studio + Genymotion working</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/11/14/running-couchbase-cluster-under-docker/">Running Couchbase Cluster Under Docker</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-11-14T15:45:00+00:00" pubdate data-updated="true">Nov 14<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><strong>This blog post is pretty out of date, you should check out <a href="http://tleyden.github.io/blog/2014/11/01/running-couchbase-cluster-under-coreos-on-aws/">Running Couchbase Cluster Under CoreOS on AWS</a> instead</strong></p>

<p>This tutorial will show you how to run a cluster of Couchbase Servers, where each node is running inside of a docker image.</p>

<p><img src="http://cl.ly/image/2G0h381N3o42/docker%20couchbase%20cluster.png" alt="Diagram" /></p>

<p>This probably looks like <em>a lot</em> of layers, and you might be wondering if this will make your system crawl &mdash; but bear in mind that the Docker virtualization model is very lightweight, and so basically everything under CoreOS has very little resource overhead.</p>

<h2>Install Docker and dependencies</h2>

<p>If you are on OSX and don&rsquo;t have Docker installed, check out <a href="http://tleyden.github.io/blog/2013/11/12/docker-on-osx/">Install Docker on OSX</a> before proceeding.</p>

<h2>Edit vagrant file to add port mappings</h2>

<p>In order to access all the Couchbase Server nodes from the host, <em>which doesn&rsquo;t currently work</em>, you would need to add the following entries to your Vagrantfile:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>config.vm.network "forwarded_port", guest: 8091, host: 8091
</span><span class='line'>config.vm.network "forwarded_port", guest: 8092, host: 8092
</span><span class='line'>config.vm.network "forwarded_port", guest: 11210, host:   11210</span></code></pre></td></tr></table></div></figure>


<p>As mentioned, accessing all of the Couchbase Server nodes from the host does not currently work.  However, I think at least some of these entries are needed, so to be on the safe side just add all of them.</p>

<h2>Start CoreOS and ssh in</h2>

<p>Execute the following commands in the directory where you have your CoreOS Vagrantfile.  In my case, I have it under <code>~/Tools/coreos-vagrant</code> and it contains a Vagrantfile, a README.md file, and a few others.</p>

<p>Start CoreOS</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant up</span></code></pre></td></tr></table></div></figure>


<p>SSH into CoreOS</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ vagrant ssh</span></code></pre></td></tr></table></div></figure>


<h2>Start docker image for a single node</h2>

<p>Here&rsquo;s how to fire up the first docker image</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>docker run -i -t -d -p 11210:11210 -p 8091:7081 -p 8092:8092 dustin/couchbase:latest</span></code></pre></td></tr></table></div></figure>


<p>and you should see:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Unable to find image 'dustin/couchbase:latest' (tag: latest) locally
</span><span class='line'>Pulling repository dustin/couchbase
</span><span class='line'>9e0279ab340d: Download complete
</span><span class='line'>...
</span><span class='line'>845987ce946b</span></code></pre></td></tr></table></div></figure>


<p>Find the name of the docker instance by running <code>$ docker ps</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>core@localhost ~ $ docker ps
</span><span class='line'>CONTAINER ID        IMAGE                     COMMAND                CREATED              STATUS              PORTS                                                                      NAMES
</span><span class='line'>845987ce946b        dustin/couchbase:latest   /bin/sh -c /usr/loca   About a minute ago   Up About a minute   0.0.0.0:11210-&gt;11210/tcp, 0.0.0.0:8091-&gt;7081/tcp, 0.0.0.0:8092-&gt;8092/tcp   purple_kangaroo</span></code></pre></td></tr></table></div></figure>


<p>In this case it&rsquo;s <em>purple_kangaroo</em>.</p>

<p>Now take a look at the logs for that docker instance:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>core@localhost ~ $ docker logs purple_kangaroo
</span><span class='line'>/opt/couchbase/etc/couchbase_init.d: 45: ulimit: error setting limit (Operation not permitted)
</span><span class='line'>/opt/couchbase/etc/couchbase_init.d: 47: ulimit: error setting limit (Operation not permitted)
</span><span class='line'> * Started couchbase-server
</span><span class='line'>Starting cluster
</span><span class='line'>SUCCESS: init 127.0.0.1
</span><span class='line'>SUCCESS: bucket-create</span></code></pre></td></tr></table></div></figure>


<p>If you only want to run one Couchbase Server node, you are pretty much done and you can skip to the section below to login to the Couchbase Server admin</p>

<p>If you want to run a cluster of Couchbase Server nodes, read on.</p>

<h2>Start docker images for other nodes</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ docker run -i -t -d -link purple_kangaroo:alpha dustin/couchbase:latest</span></code></pre></td></tr></table></div></figure>


<p>This will start another node that is linked to the initial node, and will be in the same cluster.  There is some Weird Magic behind the scenes that makes that all work.</p>

<h1>Go to Couchbase Server admin</h1>

<p>Open <a href="http://localhost:8091/">http://localhost:8091/</a> in your browser, and you should see a login screen, where the default credentials are Administrator/password.</p>

<p>After you login, you should see the Admin UI with three nodes in your cluster:</p>

<p><img src="http://cl.ly/image/2K3i1v2w3H0E/Screen%20Shot%202013-11-14%20at%204.47.18%20PM.png" alt="Screenshot" /></p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/5/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/3/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>
  I&#8217;m a software engineer at Couchbase, working on <a href="http://developer.couchbase.com/mobile/">Couchbase Mobile</a> &#8211; a mobile NoSQL database with Sync that runs on iOS, Android, and .NET platforms.
  </p>

  <p>
  In my spare time I am working on <a href="https://github.com/tleyden/elastic-thought">ElasticThought</a> &#8211; a scalable containerized REST API wrapper for the Caffe Deep Learning toolkit.
  </p>

</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/02/06/octopress-under-docker/">Octopress Under Docker</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/03/setting-up-uniqush-with-apns/">Setting Up Uniqush With APNS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/22/cuda-7-dot-5-on-aws-gpu-instance-running-ubuntu-14-dot-04/">CUDA 7.5 on AWS GPU Instance Running Ubuntu 14.04</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/22/running-neural-style-on-an-aws-gpu-instance/">Running Neural Style on an AWS GPU Instance</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/11/03/running-the-sync-gateway-amazon-ami/">Running the Sync Gateway Amazon AMI</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tleyden">@tleyden</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tleyden',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>


  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2016 - Traun Leyden -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sevenstoryrabbithole';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
